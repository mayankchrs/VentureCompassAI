commands:
  01_node_memory_limit:
    command: export NODE_OPTIONS="--max-old-space-size=900"
  02_set_npm_registry:
    command: npm config set registry https://registry.npmjs.org/

container_commands:
  01_npm_install:
    command: npm ci --only=production
  02_build_app:
    command: |
      export NODE_OPTIONS="--max-old-space-size=900"
      npm run build
  03_cleanup:
    command: |
      # Clean up to save disk space
      rm -rf node_modules/.cache
      rm -rf .next/cache/webpack
      npm prune --production

files:
  "/opt/elasticbeanstalk/tasks/taillogs.d/nextjs.conf":
    mode: "000644"
    owner: root  
    group: root
    content: |
      /var/log/web.stdout.log