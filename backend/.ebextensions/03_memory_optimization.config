commands:
  01_install_swap:
    command: |
      # Create swap file for t2.micro (1GB RAM) to prevent OOM
      if [ ! -f /swapfile ]; then
        sudo dd if=/dev/zero of=/swapfile bs=1M count=1024
        sudo chmod 600 /swapfile
        sudo mkswap /swapfile
        sudo swapon /swapfile
        echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
      fi
    test: test ! -f /swapfile

files:
  "/opt/elasticbeanstalk/tasks/bundlelogs.d/memory_logs.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      /var/log/web.stdout.log
      /var/log/web.stderr.log

container_commands:
  01_optimize_python:
    command: |
      # Optimize Python for low memory usage
      export PYTHONOPTIMIZE=1
      export PYTHONDONTWRITEBYTECODE=1